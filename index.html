<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Air Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}
.card{
  background:#1e293b;
  padding:20px;
  margin:15px;
  border-radius:15px;
}
button{
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:30px;
  font-size:16px;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
.auto{ background:#22c55e; color:white; }
.manual{ background:#3b82f6; color:white; }
.off{ background:#475569; color:white; }

.spin{
  animation:spin 1s linear infinite;
}
@keyframes spin{
  from{transform:rotate(0deg);}
  to{transform:rotate(360deg);}
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#22c55e;
  padding:10px 20px;
  border-radius:20px;
  display:none;
}

</style>
</head>
<body>

<h1>ðŸŒ« Air Monitor</h1>

<div class="card">
  <h2>PM2.5: <span id="pm25">--</span> Âµg/mÂ³</h2>
  <h3>Temp: <span id="temp">--</span> Â°C</h3>
  <h3>Humidity: <span id="humidity">--</span> %</h3>
</div>

<div class="card">
  <button id="modeBtn" class="auto">AUTO</button>
  <br>
  <button id="fanBtn" class="off">ðŸŒ€ Fan OFF</button>
  <button id="humBtn" class="off">ðŸ’§ Humidifier OFF</button>
</div>

<div class="toast" id="toast">Success</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBtBC7BkOHnDezC-0U6rygYgunr3lTrnGg",
  authDomain: "air-monitor-f064a.firebaseapp.com",
  databaseURL: "https://air-monitor-f064a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "air-monitor-f064a",
  storageBucket: "air-monitor-f064a.firebasestorage.app",
  messagingSenderId: "817370230381",
  appId: "1:817370230381:web:3357198d9f4f90c7069964"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const pm25El = document.getElementById("pm25");
const tempEl = document.getElementById("temp");
const humEl = document.getElementById("humidity");

const modeBtn = document.getElementById("modeBtn");
const fanBtn = document.getElementById("fanBtn");
const humBtn = document.getElementById("humBtn");
const toast = document.getElementById("toast");

function showToast(msg){
  toast.innerText = msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2000);
}

onValue(ref(db,"/"), snapshot=>{
  const data = snapshot.val();
  if(!data) return;

  pm25El.innerText = data.sensor?.pm25 ?? "--";
  tempEl.innerText = data.sensor?.temp ?? "--";
  humEl.innerText = data.sensor?.humidity ?? "--";

  const mode = data.control?.mode ?? "AUTO";
  const fan = data.control?.fan ?? false;
  const humid = data.control?.humidifier ?? false;

  modeBtn.innerText = mode;
  modeBtn.className = mode==="AUTO" ? "auto" : "manual";

  fanBtn.disabled = mode==="AUTO";
  humBtn.disabled = mode==="AUTO";

  fanBtn.innerHTML = fan ? "ðŸŒ€ <span class='spin'>Fan ON</span>" : "ðŸŒ€ Fan OFF";
  humBtn.innerText = humid ? "ðŸ’§ Humidifier ON" : "ðŸ’§ Humidifier OFF";

  fanBtn.className = fan ? "manual" : "off";
  humBtn.className = humid ? "manual" : "off";
});

modeBtn.onclick = ()=>{
  update(ref(db,"control"),{
    mode: modeBtn.innerText==="AUTO"?"MANUAL":"AUTO"
  });
  showToast("Mode Updated");
};

fanBtn.onclick = ()=>{
  update(ref(db,"control"),{
    fan: !fanBtn.innerText.includes("ON")
  });
  showToast("Fan Updated");
};

humBtn.onclick = ()=>{
  update(ref(db,"control"),{
    humidifier: !humBtn.innerText.includes("ON")
  });
  showToast("Humidifier Updated");
};

</script>

</body>
</html>
