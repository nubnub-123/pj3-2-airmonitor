<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Indoor Air Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f1f5f9;
}

h1{
  text-align:center;
  margin:20px 0;
  font-size:1.8rem;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

.top{
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  justify-content:center;
}

.card{
  background:white;
  border-radius:24px;
  padding:20px;
  box-shadow:0 15px 35px rgba(0,0,0,0.07);
  text-align:center;
  flex:1;
  min-width:240px;
}

.value{
  font-size:2.5rem;
  font-weight:bold;
}

.status{
  margin-top:8px;
  font-weight:bold;
}

.on{color:#16a34a;}
.off{color:#dc2626;}

button{
  padding:12px 20px;
  border:none;
  border-radius:14px;
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
  transition:.2s;
}
button:hover{transform:scale(1.05)}

.btn-green{background:#16a34a;color:white;}
.btn-red{background:#dc2626;color:white;}
.btn-blue{background:#2563eb;color:white;}

.fan-icon{
  font-size:3rem;
  display:inline-block;
}

.spin{
  animation:spin 1s linear infinite;
}

@keyframes spin{
  from{transform:rotate(0deg)}
  to{transform:rotate(360deg)}
}

.gauge{
  width:180px;
  height:180px;
  margin:auto;
}

canvas{
  margin-top:20px;
}

@media(max-width:768px){
  .top{flex-direction:column;}
}
</style>
</head>
<body>

<h1>ðŸŒ± Indoor Air Monitoring System</h1>

<div class="container">

<div class="top">

<div class="card">
  <h3>Temperature</h3>
  <div class="value"><span id="t">--</span>Â°C</div>
</div>

<div class="card">
  <h3>Humidity</h3>
  <div class="value"><span id="h">--</span>%</div>
</div>

<div class="card">
  <h3>Dust Level</h3>
  <canvas id="gauge" class="gauge"></canvas>
  <div class="value"><span id="d">--</span></div>
</div>

<div class="card">
  <h3>Fan</h3>
  <div class="fan-icon" id="fanIcon">ðŸŒ€</div>
  <div class="status off" id="fanStatus">OFF</div>
  <button id="fanBtn" class="btn-red">Toggle</button>
</div>

<div class="card">
  <h3>Humidifier</h3>
  <div style="font-size:3rem;">ðŸ’§</div>
  <div class="status off" id="humStatus">OFF</div>
  <button id="humBtn" class="btn-red">Toggle</button>
</div>

</div>

<div class="card">
  <h3>History (Dust)</h3>
  <canvas id="chart"></canvas>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { getDatabase, ref, onValue, update, get } 
from "https://www.gstatic.com/firebasejs/12.10.0/firebase-database.js";

const firebaseConfig={
  apiKey:"YOUR_API_KEY",
  authDomain:"air-monitor-f064a.firebaseapp.com",
  databaseURL:"https://air-monitor-f064a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"air-monitor-f064a"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

let fanState=false;
let humState=false;

/* --------- Gauge --------- */
const gauge=new Chart(document.getElementById("gauge"),{
  type:'doughnut',
  data:{
    labels:['Dust','Remain'],
    datasets:[{
      data:[0,200],
      backgroundColor:['#16a34a','#e5e7eb'],
      borderWidth:0
    }]
  },
  options:{
    rotation:-90,
    circumference:180,
    plugins:{legend:{display:false}},
    cutout:'70%'
  }
});

/* --------- Line Chart --------- */
const chart=new Chart(document.getElementById("chart"),{
  type:'line',
  data:{labels:[],datasets:[{
    label:'Dust',
    data:[],
    borderColor:'#dc2626',
    tension:.4
  }]}
});

/* --------- Live Sensor --------- */
onValue(ref(db,"sensor"),snap=>{
  const s=snap.val();
  if(!s) return;

  t.innerText=s.temp;
  h.innerText=s.humidity;
  d.innerText=s.dust;

  let color="#16a34a";
  if(s.dust>50) color="#f59e0b";
  if(s.dust>150) color="#dc2626";

  gauge.data.datasets[0].data=[s.dust,200-s.dust];
  gauge.data.datasets[0].backgroundColor=[color,'#e5e7eb'];
  gauge.update();
});

/* --------- Control --------- */
onValue(ref(db,"control"),snap=>{
  const c=snap.val();
  if(!c) return;

  fanState=c.fan;
  humState=c.humidifier;

  updateDevice("fanStatus","fanIcon",fanState);
  updateDevice("humStatus",null,humState);
});

function updateDevice(statusId,iconId,state){
  const s=document.getElementById(statusId);
  s.innerText=state?"ON":"OFF";
  s.className="status "+(state?"on":"off");

  if(iconId){
    const icon=document.getElementById(iconId);
    state?icon.classList.add("spin"):icon.classList.remove("spin");
  }
}

/* --------- Buttons --------- */
fanBtn.onclick=()=>update(ref(db,"control"),{fan:!fanState});
humBtn.onclick=()=>update(ref(db,"control"),{humidifier:!humState});

/* --------- History --------- */
async function loadHistory(){
  const snap=await get(ref(db,"history/minute"));
  const data=snap.val();
  if(!data) return;

  const arr=Object.values(data);
  chart.data.labels=arr.map(x=>x.time);
  chart.data.datasets[0].data=arr.map(x=>x.dust);
  chart.update();
}

loadHistory();

</script>

</body>
</html>
